---
title: "General info"
page-layout: full
sidebar: false
---

```{r}
#| echo: false
#| output: false

library(gt)
library(dplyr)
```


![](img/rcc_gif.gif)

We're a bi-weekly open coding café for anyone working at Steno Aarhus (SDCA), Dept. of Endocrinology (HoK), AU-Public Health, AU-Clinical Medicine and AU-Biomedicine to come and get help with their code.

  \
  
## Format

Below are the planned dates; you can arrive and leave at any time. 

There will be a ~15 minute presentation at the beginning of each session, tackling a relevant topic (a general R concept, workflows, helpful packages, etc.)

Subsequently, 1-2 experienced instructors will help with your specific challenges and questions. But please interact with each other—maybe someone in the group has the solution to your exact problem.

::: {.callout-tip collapse="true" appearance="simple"}
## Prerequisites

You're expected to have an introductory knowledge of R and RStudio; consider 

- a course such as <a href="https://r-cubed-intro.rostools.org/">this</a> offered by the Danish Diabetes and Endocrinology Academy
- an online course such as <a href="https://www.datacamp.com/courses/free-introduction-to-r">this one at Datacamp.com</a>
- the fantastic online book <a href="https://r4ds.hadley.nz/intro.html">R for Data Science</a>
:::
  \
  
## Schedule and themes

```{r}
#| echo: false

source("schedule.R")

timeline <- timeline_raw |> 
  mutate(Time = paste0(stringr::str_extract(T_start, "^[0-9]+:[0-9]+"),
                       "-", 
                       stringr::str_extract(T_end, "^[0-9]+:[0-9]+"))) |>
  select(c(Passed, Date, Week, Time, Location, Topic, Note_URL, Presenter, Helpers))

timeline_raw <- timeline_raw |> 
  mutate(
    T_start = as.POSIXct(paste(Date, T_start), tz = "Europe/Copenhagen"),
    T_end = as.POSIXct(paste(Date, T_end), tz = "Europe/Copenhagen")
  )

previous <- timeline |> filter(Passed == "Previous") |> select(-c(Passed))
upcoming <- timeline |> filter(Passed != "Previous") |> {\(x) {
  if(x$Passed |> unique() |> length() > 1) return(x)
  else return(x |> select(-c(Passed)))
}}() |> select(-c(Note_URL))
```

::: {.callout-note collapse="true" appearance="minimal" icon="false"}
## Previous sessions

```{r}
#| echo: false

gt(previous, rowname_col = "Date")|>
  fmt_datetime(
    columns = Date,
    format = "EEE, MMM d, y",
    locale = "en"
  ) |> 
  tab_style(style = cell_text(weight = "bold"), locations = cells_column_labels()) |>
  tab_header(
    title = "Dates, times, locations, and lesson topics.",
    subtitle = html("&nbsp;")
  ) |>
  fmt_url(
    columns = Note_URL,
    label = "(notes)",
    show_underline = FALSE,
    color = "#990032"
  ) |>
  cols_merge(
    columns = c(Topic, Note_URL),
    pattern = "{1} {2}"
  ) |>
  sub_missing(columns = Note_URL, missing_text = html("&nbsp;"))
```
:::
  \

#### Upcoming sessions

[Add to your calendar](webcal://r-coding-cafe.zheer.dk/r-coding-cafe.ics){.btn .btn-outline-primary .btn role="button" data-toggle="tooltip" title="Automatically updated upon changes."} to receive automatic updates.

```{r}
#| echo: false

gt(upcoming, rowname_col = "Date", groupname_col="Passed") |>
  fmt_datetime(
    columns = Date,
    format = "EEE, MMM d, y",
    locale = "en"
  ) |> 
  tab_style(style = cell_text(weight = "bold"), locations = cells_column_labels()) |>
  tab_style(style = cell_fill(color = "lightsteelblue2"), 
            locations = cells_body(
              rows = Date == min(Date[Date >= lubridate::today()])
            )
  ) |>
  tab_style(style = cell_fill(color = "lightgrey"), 
            locations = list(
              cells_stub(rows = Topic == "Intermezzo"),
              cells_body(rows = Topic == "Intermezzo")
            )
  ) |>
  text_transform(
    fn = function(x) "",
    locations = list(
      cells_body(rows = Topic == "Intermezzo"),
      cells_stub(rows = Topic == "Intermezzo")
    )
  ) |>
  text_transform(
    fn = function(x) "Intermezzo",
    locations = cells_body(rows = Topic == "Intermezzo", columns = Location)
  ) |>
  tab_header(
    title = "Dates, times, locations, and lesson topics",
    subtitle = "Note, the schedule may be subject to change"
  )

```

#### Other planned themes are:

- Nice to know packages (e.g., `{gtsummary}`, `{Epi}`, and `{Hmisc}`)
- Matching and Weighting (using `{MatchIt}` and `{WeightIt}` packages)
- Missing data: relevant packages, including imputation via `{mice}` and combining this with `{MatchThem}`/`{WeightThem}`
- Preregistration as a means to improved workflows in R

Reach out to me if you want anything added to the list.

```{r}
#| echo: false
#| output: false

current_timeline <- timeline_raw |> 
  filter(Topic != "Intermezzo") |>
  arrange(Date) |>
  mutate(
    sequence = 0,
    stable_uids = Date |> {\(event_id, domain = "r-coding-cafe.zheer.dk") {
    hash <- paste0(rank(event_id), domain) |> {digest::digest |> Vectorize()}()
    sprintf("%s-%s-%s-%s-%s@%s",
            substr(hash, 1, 8),
            substr(hash, 9, 12),
            substr(hash, 13, 16),
            substr(hash, 17, 20),
            substr(hash, 21, 32),
            domain)
  }}()
  )

if (!file.exists("schedule.csv")) {
  current_timeline |> 
    write.csv("schedule.csv", row.names = F)
}

previous_timeline <- read.csv("schedule.csv") |> 
  tibble() |>
  mutate(Week = sprintf("%02.f", Week),
         T_start = T_start |> as.POSIXct(tz = "Europe/Copenhagen"),
         T_end = T_end |> as.POSIXct(tz = "Europe/Copenhagen"))


create_event <- function(row_idx, current_schedule, previous_schedule ) {
  row <- current_schedule[row_idx,]
  comp_row <- previous_schedule[row_idx,]
  
  # Current timestamp for DTSTAMP (when the calendar was generated)
  current_timestamp <- format(Sys.time(), "%Y%m%dT%H%M%S", tz = "Europe/Copenhagen")
  
  # Get latest sequence
  if (nrow(previous_schedule) >= nrow(current_schedule)) {
    row$sequence <- comp_row$sequence
    if (comp_row$T_start != row$T_start | 
        comp_row$T_end != row$T_end | 
        comp_row$Location != row$Location)  {
      row$sequence <- row$sequence + 1
    }
  } else {
    row$sequence <- 0
  }
  
  row$Event <- sprintf(
    "BEGIN:VEVENT
UID:%s
DTSTAMP:%s
DTSTART:%s
DTEND:%s
SEQUENCE:%s
STATUS:CONFIRMED
SUMMARY:R Coding Café
URL:https://r-coding-cafe.zheer.dk
DESCRIPTION:Topic: %s
LOCATION:%s
END:VEVENT", 
    row$stable_uids,
    current_timestamp,
    row$T_start |> format("%Y%m%dT%H%M%S", tz = "Europe/Copenhagen"),
    row$T_end |> format("%Y%m%dT%H%M%S", tz = "Europe/Copenhagen"),
    row$sequence,
    row$Topic,
    row$Location
)
  return(row)
}

updated_timeline <- lapply(1:nrow(current_timeline), create_event, current_timeline, previous_timeline) |> bind_rows()

updated_timeline |> 
    write.csv("schedule.csv", row.names = F)

paste0("BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//R Coding Café//NONSGML v1.0//EN
CALSCALE:GREGORIAN
METHOD:PUBLISH
X-WR-CALNAME:R Coding Café
X-WR-TIMEZONE:Europe/Copenhagen
X-WR-CALDESC:Bi-weekly coding café sessions
",
(updated_timeline$Event |> paste(collapse="\n")),
"
END:VCALENDAR"
) |>
  writeLines("r-coding-cafe.ics")
```

  \
  \
  
This website was made in Quarto: see how <a href="https://github.com/zheer-kejlberg/R-coding-cafe">here</a>
